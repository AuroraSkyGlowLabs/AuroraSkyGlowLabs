<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AuroraSkyGlowLabs</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #map { height: 600px; width: 100%; margin-top: 20px; }
  form label, select, input, button { display: block; margin: 5px 0; }
  button { cursor: pointer; }
</style>
</head>
<body>

<h1>AuroraSkyGlowLabs</h1>
<p>Submit your aurora or sky sightings! Use your location or enter manually.</p>

<form id="reportForm">
  <label for="event">Event / Intensity:</label>
  <select id="event" required>
    <option value="fullMoon">Well, itâ€™s a full moon. Just wanted to report it ğŸŒ•</option>
    <option value="meteor">Meteor shower event, donâ€™t mind me ğŸŒ </option>
    <option value="clouds">Clouds look cool today â˜ï¸</option>
    <option value="surprised">ğŸ˜²ğŸ˜³</option>
    <option value="faint">Faint aurora ğŸŒŒ</option>
    <option value="bright">Bright aurora ğŸŒŒ</option>
    <option value="amazing">Amazing aurora ğŸŒŒ</option>
    <option value="magical">This is literally magical âœ¨</option>
    <option value="speechless">Speechless ğŸ˜¶</option>
    <option value="staring">Send help, I canâ€™t stop staring ğŸ˜µ</option>
    <option value="mindBlown">Mind = Blown ğŸ¤¯</option>
    <option value="callNASA">Call NASA ğŸ›¸</option>
    <option value="crying">Holt shit I can't believe my eyes I'm crying my face off ğŸ˜­</option>
    <option value="heaven">Am I in heaven? ğŸ˜‡</option>
    <option value="tearsJoy">Sobbing tears of joy ğŸ˜­ğŸ’–</option>
    <option value="aliens">Aliens confirmed ğŸ‘½</option>
    <option value="skyFire">Caught the sky on fire ğŸ”¥</option>
    <option value="postcard">Send a postcard, this is insane ğŸ“¬</option>
    <option value="tornadoAurora">Tornado + Aurora ğŸŒªï¸ğŸŒŒ</option>
  </select>

  <label for="lat">Latitude (optional):</label>
  <input type="number" id="lat" step="0.0001" placeholder="e.g., 43.0731">

  <label for="lng">Longitude (optional):</label>
  <input type="number" id="lng" step="0.0001" placeholder="e.g., -89.4012">

  <button type="submit">Report</button>
</form>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const repoURL = "https://raw.githubusercontent.com/AuroraSkyGlowLabs/AuroraReports/main/reports.json";

// Initialize map
const map = L.map('map').setView([43.0731, -89.4012], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

const markers = L.layerGroup().addTo(map);

const eventIcons = {
  fullMoon: 'ğŸŒ•', meteor: 'ğŸŒ ', clouds: 'â˜ï¸', surprised: 'ğŸ˜²ğŸ˜³',
  faint: 'ğŸŒŒ', bright: 'ğŸŒŒ', amazing: 'ğŸŒŒ', magical: 'âœ¨',
  speechless: 'ğŸ˜¶', staring: 'ğŸ˜µ', mindBlown: 'ğŸ¤¯', callNASA: 'ğŸ›¸',
  crying: 'ğŸ˜­', heaven: 'ğŸ˜‡', tearsJoy: 'ğŸ˜­ğŸ’–', aliens: 'ğŸ‘½',
  skyFire: 'ğŸ”¥', postcard: 'ğŸ“¬', tornadoAurora: 'ğŸŒªï¸ğŸŒŒ'
};

// Load reports from GitHub JSON
async function loadReports() {
  try {
    const res = await fetch(repoURL);
    const data = await res.json();
    data.forEach(r => addMarker(r.lat, r.lng, r.event));
  } catch (e) {
    console.error("Failed to load reports:", e);
  }
}

function addMarker(lat, lng, event) {
  const marker = L.marker([lat, lng]).addTo(markers);
  marker.bindPopup(eventIcons[event] + " " + event);
}

loadReports();

// Submission (local only; instructions for saving to repo)
document.getElementById('reportForm').addEventListener('submit', e => {
  e.preventDefault();
  const event = document.getElementById('event').value;
  let lat = parseFloat(document.getElementById('lat').value);
  let lng = parseFloat(document.getElementById('lng').value);

  if (!lat || !lng) {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        lat = pos.coords.latitude;
        lng = pos.coords.longitude;
        addMarker(lat, lng, event);
        showRepoAlert(lat, lng, event);
      });
    } else {
      alert("Please provide a location or enable geolocation.");
    }
  } else {
    addMarker(lat, lng, event);
    showRepoAlert(lat, lng, event);
  }
});

// Dynamic alert with JSON template including timestamp
function showRepoAlert(lat, lng, event) {
  const timestamp = Date.now(); // current time in milliseconds

  alert(
`ğŸŒŒ Report added locally!

To make your report permanent for everyone, update the AuroraReports repo on GitHub. Hereâ€™s how:

1ï¸âƒ£ Go to the repo: https://github.com/AuroraSkyGlowLabs/AuroraReports
2ï¸âƒ£ Click on the file named 'reports.json'.
3ï¸âƒ£ Click the pencil icon (Edit this file).
4ï¸âƒ£ Inside the square brackets [ ], add a new report object, separated by a comma if there are other reports.

Hereâ€™s your report JSON (ready to copy!):

{
  "lat": ${lat},     
  "lng": ${lng},     
  "event": "${event}",  
  "timestamp": ${timestamp} 
}

5ï¸âƒ£ Scroll down to 'Commit changes', add a message like "Add new aurora report from [your name]".
6ï¸âƒ£ Choose 'Commit directly to the main branch'.
7ï¸âƒ£ Click 'Commit changes'.

Your report will now appear on the site for everyone!`
  );
}
</script>

</body>
</html>
